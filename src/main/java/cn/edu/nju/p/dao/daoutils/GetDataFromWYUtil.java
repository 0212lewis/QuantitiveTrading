package cn.edu.nju.p.dao.daoutils;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;

import java.io.File;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

/**
 * Created by dell- on 2017/6/9.
 */
public class GetDataFromWYUtil {

    private static final String WangYi_FINANCE_URL = "http://quotes.money.163.com/trade/lsjysj_";
    private static final String FILE_PATH="D://StockData//";
    private String year;
    private String season;


    private static final GetDataFromWYUtil dataHelper = new GetDataFromWYUtil();

    public static GetDataFromWYUtil getInstance() {
        return dataHelper;
    }

    /**
     * Jsoup初始化
     * @param URL
     * @return
     */
    private Document getDocument(String URL) {
        try{
            return Jsoup.connect(URL).timeout(8000).get();
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }

    public List<String> getStockHistoryData(String code, int year, int season) {
        String url = WangYi_FINANCE_URL + code + ".html?year=" + year + "&season=" + season;
        String filePath = FILE_PATH + year;

        Document doc = getDocument(url);
        Elements table = doc.select("[class=table_bg001 border_box limit_sale]");
        Elements data=table.select("tr");
        List<String>  dataList=new ArrayList<String>();
//        dataList.add(data.get(0).text().replaceAll(" ", ",")); //标题
        for(int i=1;i<data.size();i++) { //除去标题
            dataList.add(data.get(i).text().replaceAll(",","").replaceAll(" ",","));
//            System.out.println(data.get(i).text().replaceAll(",","").replaceAll(" ",","));
        }
        return dataList;
    }

    public static void main(String[] args) {
        List<String> dataList = new ArrayList<>();
        String title="日期,开盘价,最高价,最低价,收盘价,涨跌额,涨跌幅(%),成交量(手),成交金额(万元),振幅(%),换手率(%)";
        //"000001", "000025", "002484", "002116", "002013", "002032", "300030","002442", "300165", "002030","300038", "001696", "002038", "002313", "002156", "002259", "300089", "002550", "002033", "002175", "300139", "002227", "300149", "300173", "002423", "000032", "002393", "300023", "300132", "002477", "300141", "002109", "002373", "300054", "002143", "300121", "002258", "002106", "002228", "002140", "000035", "002049", "002136", "002530", "002224", "002132", "002007", "002041", "002144", "300096", "300081", "002216", "002045", "002148", "002542", "002022", "300136", "002443", "002546", "000029", "000021", "002488", "002086", "002480", "002112", "002547", "002145", "002002", "002514", "002147", "300169", "002531", "002549", "002164", "300051", "002187", "002113", "002314", "002345", "002298","002487", "002554", "002171", "300007", "000036", "300027", "002378", "002397", "300145", "002432", "002446", "002009", "002377", "002188", "002346", "002342", "300058", "002325", "300062", "300172", "002508", "002010", "002456", "002452", "002322", "300176", "300108", "002117", "002511", "300069", "300090", "300061", "002339", "002515", "300065", "002270", "300130", "300020", "002149", "300123", "002543", "300094", "002059", "002457", "300134", "002453", "002321", "002244", "002429", "300166", "002082", "300082", "002448", "300112", "002183", "300185", "002286", "002449", "002535", "002366", "002483", "300002", "002263", "002389", "002413", "002162", "002310", "002558", "002251", "300037", "002500", "000401", "002510", "300114", "002102", "002173", "002176", "002092", "300009", "002409", "002425", "002519", "300092", "002315", "002359", "002279", "002005", "002476", "002403", "002516", "002341","002455", "300005", "300034", "002165", "300156", "002528", "002318", "002369", "002316", "300066", "002283", "002560", "002137", "002261", "002274", "002473", "002334", "002361", "300097", "300100", "002416", "000019", "002306", "002503", "002105", "002197", "002420", "002376", "300050", "300073", "002329", "002018", "002526", "300018", "002179", "002428", "300083", "002068", "002177", "002100", "300147", "002559", "002034", "002050", "002011", "002230", "002235", "002499", "300105", "002398", "002202", "002518", "002338", "002238", "002372", "300187", "002226", "002353", "300171", "002539", "002395", "002459", "002272", "000034", "000030", "002356", "000039", "300102", "002207", "002472", "300152", "002495", "002355", "300026", "000031", "002271", "300144", "300125", "300049", "300041", "002247", "002019", "002532", "002037", "002053", "002451", "002232", "002081", "300180", "002111", "300143", "300160", "002384", "002195", "002468", "300086", "300116", "002418", "002357", "002254", "002121", "002077", "300183", "000157", "002098", "002504", "002311", "002255", "002412", "002211", "300168", "002134", "002127", "002123", "002536", "002551", "002215", "002061", "002138", "300055", "300148", "002065", "002072", "300113", "002496", "300117", "002463", "002203", "002161", "300151", "002362", "002380","000010", "300017", "002287", "002566", "002250", "002352", "002349", "300015", "000402", "002299", "002246", "002265", "000016", "300098", "300104", "002184", "002210", "002365", "002312", "002293", "002170", "002220", "300059", "002304", "000028", "000150", "002199", "002097", "002206", "002374", "002275", "000158", "002172", "002290", "002191", "300177", "002133", "002436", "002407", "300093", "002333", "300140", "002248", "000301", "002043", "000040", "002016", "300033", "002427", "002054", "002001", "002439", "300101", "000004", "002058", "002541", "002071", "002556", "002128", "002394", "002096", "300120", "002085", "002057", "002069", "300042", "002467", "002026", "002101", "002390", "002088", "002178", "300006", "002475", "002337", "002222", "300003", "300014", "002424", "002243", "002155", "002282", "002445", "002523", "002094", "002396", "002120", "300126", "002522", "002006", "002029", "002062", "002469", "300019","300137", "002385", "002297", "002491", "300129","300016", "002212", "002055","000159", "002040", "002231", "002151", "002509", "002169", "002252", "002083", "002323", "002370", "002405", "300109", "002485", "002186", "002110", "002305", "002208", "002431", "300013", "002168", "300106", "002139", "002533", "300080", "002152", "002354", "002302", "000014", "002320", "002291", "002285", "002262", "002080", "000017", "002557", "002089", "000100", "002497", "002012", "002308", "002489", "002157", "002326", "000155", "002047", "002180", "300164", "300021", "000153", "000011", "002189", "002108", "300064", "002052", "002129", "300124", "002408", "002507", "002465", "300057", "002154", "300010", "002236", "002505", "002462", "002502", "002196", "002294", "002093", "002368", "002388", "002239", "000027", "002404", "002074", "002234", "002289", "300184", "002433", "300075", "300072", "002330", "300035", "002490", "001896", "300181", "002223", "002426", "002046", "002534", "300084", "002229", "002561", "002479", "300047", "002383", "002437", "300157", "002066", "002440", "002237", "300110", "002163", "002240", "002340", "002014", "002348", "002303", "002421", "002382", "002063", "002391", "000338", "002242", "002517", "300022", "300099", "000023", "002204", "002194", "002363", "300155", "002364", "002260", "000020", "002471", "002027", "002548", "002464", "300178", "002411", "300119", "000022", "002482", "002003", "002454", "300078", "000037", "002414", "002103", "002004", "002020", "002381", "002015", "300063", "002146", "002060", "002023", "002078", "002565", "300163", "002460", "300161", "300001", "002126", "002017", "002406", "002131", "300039", "002417", "002317", "300133", "300067", "300175", "002527", "300077", "002219", "002434", "300024", "002091", "002192", "002379", "300043", "002524", "002153", "002347", "002415", "002332", "300032", "300074", "002076", "002470", "002025", "002039", "002042", "002358", "002181", "002142", "002249", "002125", "002159", "002444", "002458", "002124", "002167", "000151", "002073", "300150","002214", "000400", "002540", "002218", "300056", "002070", "002135", "002350", "300070", "300127", "300153", "002520", "300029", "002118", "002035", "002447", "002185", "002513", "002386", "002555", "002301", "002278", "300167", "002190", "002538", "300122", "000012", "002245", "002280", "002104", "002114", "002295", "300135", "002095", "002493", "002205", "300025", "300158", "300076", "300186", "300085", "002438", "300071", "300053", "002461", "002309", "300004", "002288", "002266", "002200", "300008", "002474", "002375", "300046", "300031", "002400", "002422", "002399", "300040", "002360", "000002", "002435", "002401", "002256", "002087", "002481", "002506", "002253", "000033", "002367", "002122", "002450", "002021", "300159", "002492", "002024", "002307", "002267", "002466", "002221", "002392", "002281", "002552", "300128", "002067", "300011", "300012", "002201", "002119", "002296", "300045", "002150", "002028", "002084", "300179", "002051", "002213", "002036", "002079", "002264", "002498", "300091", "002130", "002273", "300182", "002141", "300131", "000026", "002064", "300142", "002008", "300174", "002090", "002544", "002324", "002521", "002344", "002193", "002387", "300088", "002486", "002441", "002115", "002512", "300068", "002198", "002501", "002430", "002044", "300107", "300111", "002269", "002328", "300048", "002336", "300118", "002268", "002319", "300115", "002331", "002553", "002371", "002277", "300052", "002327", "002419", "002494", "002056", "300170", "002241", "002174", "000018", "002478", "002099", "002182", "002233", "002048", "002410", "300103", "002225", "002529", "002351", "300044", "002292", "002545", "300028", "002300", "002107", "002166", "300036", "002537", "002158", "002217", "300162", "300095", "002402", "002335", "300154", "002209", "002276",
        String[] stockList = {  "002031", "300146", "002343", "300079", "002284", "300087", "300138"};

        for(String code:stockList) {
            dataList.add(title);
            for(int year=2005;year<=2017;year++) {
                for(int season=1;season<=4;season++) {
                    dataList.addAll(GetDataFromWYUtil.getInstance().getStockHistoryData(code, year, season));
                }
            }
            boolean success=CSVUtil.exportCsv(new File(FILE_PATH + code + ".csv"), dataList);
            if (success == true) {
                System.out.println(code + "已经写入完毕");
            }else{
                System.out.println(code + "写入失败");
            }
            dataList.clear();
        }


    }

}
